FROM mongo:5.0

# Copy the JSON file to the container
COPY ./cards/cards.json /cards.json

# Set the environment variables from build arguments
ARG MONGO_INITDB_ROOT_USERNAME
ARG MONGO_INITDB_ROOT_PASSWORD
ARG MONGO_INITDB_DATABASE
ARG MONGO_INITDB_COLLECTION
ARG USERNAME
ARG PASSWORD
ARG DATABASE_URI


ENV MONGO_INITDB_ROOT_USERNAME=$MONGO_INITDB_ROOT_USERNAME
ENV MONGO_INITDB_ROOT_PASSWORD=$MONGO_INITDB_ROOT_PASSWORD
ENV MONGO_INITDB_DATABASE=$MONGO_INITDB_DATABASE
ENV MONGO_INITDB_COLLECTION=$MONGO_INITDB_COLLECTION
ENV USERNAME=$USERNAME
ENV PASSWORD=$PASSWORD
ENV DATABASE_URI=$DATABASE_URI

# Run mongoimport to import the data into MongoDB
CMD echo "The command is mongoimport --db $MONGO_INITDB_DATABASE --collection $MONGO_INITDB_COLLECTION --file /cards.json --jsonArray"
CMD mongoimport --username ${USERNAME} --password ${PASSWORD} --uri ${DATABASE_URI} --db $MONGO_INITDB_DATABASE --collection $MONGO_INITDB_COLLECTION --file /cards.json --jsonArray --mode upsert --upsertFields id
